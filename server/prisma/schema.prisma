generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id            Int      @id @default(autoincrement())
  email         String   @unique
  password_hash String
  role          String   @default("curator") // "curator" or "admin"
  createdAt     DateTime @default(now())

  exhibitions   ExhibitionVersion[]
}

model Exhibition {
  id          Int                 @id @default(autoincrement())
  title       String
  slug        String              @unique
  room_id     Int                 // Placeholder for now
  versions    ExhibitionVersion[]
}

model ExhibitionVersion {
  id                  Int        @id @default(autoincrement())
  exhibition_id       Int
  exhibition          Exhibition @relation(fields: [exhibition_id], references: [id])
  parent_version_id   Int?
  created_by_user_id  Int
  creator             User       @relation(fields: [created_by_user_id], references: [id])
  created_at          DateTime   @default(now())
  comment             String?
  is_published        Boolean    @default(false)

  // Content JSON for legacy/cache, but using relational for Phase 3
  data                Json?      
  
  instances           ArtworkInstance[]
}

model Artwork {
  id          Int      @id @default(autoincrement())
  title       String
  artist      String?
  year        String?
  description String?  @db.Text
  width       Float?   // Physical width in cm
  height      Float?   // Physical height in cm
  
  asset       Asset?   @relation(fields: [assetId], references: [id])
  assetId     Int?     @unique

  instances   ArtworkInstance[]
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Asset {
  id        Int      @id @default(autoincrement())
  filename  String
  path      String   // Relative path or URL
  mimetype  String
  size      Int
  width     Int?     // Original pixel width
  height    Int?     // Original pixel height
  dpi       Int?     // Original DPI
  metadata  Json?    // Any extra extracted metadata
  
  artwork   Artwork?
  
  createdAt DateTime @default(now())
}

model ArtworkInstance {
  id          Int               @id @default(autoincrement())
  
  artwork     Artwork           @relation(fields: [artworkId], references: [id])
  artworkId   Int
  
  version     ExhibitionVersion @relation(fields: [versionId], references: [id])
  versionId   Int

  // Transform (stored as individual floats for querying, or could be JSON)
  position_x  Float
  position_y  Float
  position_z  Float
  rotation_x  Float             @default(0)
  rotation_y  Float             @default(0)
  rotation_z  Float             @default(0)
  scale       Float             @default(1.0)

  createdAt   DateTime          @default(now())
}
